<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        padding: 0;
        margin: 0;
        /* background: rgb(252, 249, 226); */
        background: black;
        overflow: hidden;
      }
      #earth-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: rgba(10, 10, 30, 0.5);
      }
      canvas {
        display: block;
      }
      #ascii-stars {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        margin: 0;
        padding: 0;
        z-index: 0;
        color: #fff;
        background: transparent;
        font-family: monospace;
        font-size: 12px;
        line-height: 12px;
        pointer-events: none;
        user-select: none;
        white-space: pre;
      }
    </style>
    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@v0.176.0/build/three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@v0.176.0/examples/jsm/"
        }
      }
    </script>
    <title>corytheboyd.com</title>
  </head>
  <body>
    <pre id="ascii-stars"></pre>
    <div id="earth-container"></div>
    <style>
      #ascii-stars {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        margin: 0;
        padding: 0;
        z-index: 0;
        color: #fff;
        background: transparent;
        font-family: monospace;
        font-size: 12px;
        line-height: 12px;
        pointer-events: none;
        user-select: none;
        white-space: pre;
      }
    </style>
    <script>
      // ASCII Starfield
      const starChars = [".", "*", "+"];
      let starCount = 120; // number of stars
      let width = Math.floor(window.innerWidth / 12);
      let height = Math.floor(window.innerHeight / 12);
      let stars = [];

      function randomStar() {
        return {
          x: Math.floor(Math.random() * width),
          y: Math.floor(Math.random() * height),
          char: starChars[Math.floor(Math.random() * starChars.length)],
          twinkle: Math.random() * 2 * Math.PI,
        };
      }

      function createStars() {
        stars = [];
        for (let i = 0; i < starCount; i++) {
          stars.push(randomStar());
        }
      }
      createStars();

      function drawStars(time) {
        let grid = Array.from({ length: height }, () => Array(width).fill(" "));
        for (let star of stars) {
          // Twinkle effect
          const tw = Math.abs(Math.sin(time / 500 + star.twinkle));
          if (tw > 0.5) {
            grid[star.y][star.x] = star.char;
          }
        }
        document.getElementById("ascii-stars").textContent = grid
          .map((row) => row.join(""))
          .join("\n");
      }

      function animateStars(time = 0) {
        drawStars(time);
        requestAnimationFrame(animateStars);
      }
      animateStars();

      window.addEventListener("resize", () => {
        width = Math.floor(window.innerWidth / 12);
        height = Math.floor(window.innerHeight / 12);
        createStars();
      });
    </script>
    <script type="module">
      import * as THREE from "three";
      import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";
      import { AsciiEffect } from "three/addons/effects/AsciiEffect.js";

      let camera, scene, renderer, effect, model;
      const container = document.getElementById("earth-container");

      // Setup renderer and scene
      renderer = new THREE.WebGLRenderer({ antialias: false, alpha: true });
      renderer.setClearColor(0x000000, 0); // transparent
      scene = new THREE.Scene();

      // Camera
      const aspect = window.innerWidth / window.innerHeight;
      camera = new THREE.PerspectiveCamera(40, aspect, 0.1, 2000);
      camera.position.set(0, 0, 100);

      // Lighting
      // Add a much stronger main directional light
      const light = new THREE.DirectionalLight(0xffffff, 7.0);
      light.position.set(0, 0, 100);
      light.target.position.set(0, 0, 0);
      scene.add(light);
      scene.add(light.target);

      // Add a second directional light from the side
      const sideLight = new THREE.DirectionalLight(0xffffff, 4.0);
      sideLight.position.set(100, 0, 100);
      sideLight.target.position.set(0, 0, 0);
      scene.add(sideLight);
      scene.add(sideLight.target);

      // Brighter ambient light
      const ambient = new THREE.AmbientLight(0xffffff, 1.5);
      scene.add(ambient);

      // Load model
      const loader = new GLTFLoader();
      loader.load("earth_low_poly.glb", (gltf) => {
        model = gltf.scene;
        scene.add(model);

        // Center model
        const box = new THREE.Box3().setFromObject(model);
        const center = box.getCenter(new THREE.Vector3());
        model.position.sub(center);

        // Scale model to fit nicely in view
        const size = box.getSize(new THREE.Vector3());
        const maxDim = Math.max(size.x, size.y, size.z);
        model.scale.setScalar(40 / maxDim);

        // Setup AsciiEffect
        effect = new AsciiEffect(renderer, " .:-=+*%@#", {
          invert: true,
          color: true,
        });
        effect.setSize(window.innerWidth, window.innerHeight);
        effect.domElement.classList.add("ascii");
        effect.domElement.style.background = "transparent";
        container.innerHTML = "";
        container.appendChild(effect.domElement);

        // Animation loop
        renderer.setAnimationLoop(animate);

        // Responsive resize
        window.addEventListener("resize", onWindowResize);
      });

      function animate() {
        if (model) model.rotation.y += 0.03;
        effect.render(scene, camera);
      }

      function onWindowResize() {
        const w = window.innerWidth,
          h = window.innerHeight;
        camera.aspect = w / h;
        camera.updateProjectionMatrix();
        effect.setSize(w, h);
      }
    </script>
  </body>
</html>
